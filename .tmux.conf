# prefixã‚­ãƒ¼ã‚’C-qã«å¤‰æ›´ã™ã‚‹
set -g prefix C-q

# C-bã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’è§£é™¤ã™ã‚‹
unbind C-b

# C-q*2ã§tmuxå†…ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«C-qã‚’é€ã‚‹
bind C-q send-prefix

# Shift-Tab ã‚’ back_tab ã¨ã—ã¦é€ä¿¡
bind -rn S-Tab send-keys '[Z'

# æ–°è¦ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’åŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§é–‹ã
bind c new-window -c '#{pane_current_path}'

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹
bind r source-file ~/.tmux.conf \; display "Reloaded!"

# | ã§ãƒšã‚¤ãƒ³ã‚’ç¸¦ã«åˆ†å‰²ã™ã‚‹
bind | split-window -h -c '#{pane_current_path}'

# - ã§ãƒšã‚¤ãƒ³ã‚’æ¨ªã«åˆ†å‰²ã™ã‚‹
bind - split-window -v -c '#{pane_current_path}'

# xterm ã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’ä½¿ç”¨å¯èƒ½ã«ã™ã‚‹
set-option -gw xterm-keys on

# Shift + ã‚«ãƒ¼ã‚½ãƒ«ã‚­ãƒ¼ ã§ãƒšã‚¤ãƒ³ã‚’ç§»å‹•ã™ã‚‹
bind-key -nr S-Left   select-pane -L
bind-key -nr S-Right  select-pane -R
bind-key -nr S-Up     select-pane -U
bind-key -nr S-Down   select-pane -D

# Vimã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã§ãƒšã‚¤ãƒ³ã‚’ç§»å‹•ã™ã‚‹
bind-key -r h select-pane -L
bind-key -r j select-pane -D
bind-key -r k select-pane -U
bind-key -r l select-pane -R

# Shift + HJKL ã§ãƒšã‚¤ãƒ³ã‚’ãƒªã‚µã‚¤ã‚ºã™ã‚‹
bind-key -r H resize-pane -L 2
bind-key -r J resize-pane -D 2
bind-key -r K resize-pane -U 2
bind-key -r L resize-pane -R 2

# Ctrl + HJKL ã§ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç§»å‹•ã™ã‚‹
bind-key -r C-h previous-window
bind-key -r C-j switch-client -n
bind-key -r C-k switch-client -p
bind-key -r C-l next-window

# ãƒšã‚¤ãƒ³å¢ƒç•Œç·šã®è¨­å®š
# ACSã‚’å¼·åˆ¶ã—ã¦ãƒšã‚¤ãƒ³å¢ƒç•Œç·šã‚’ãã‚Œã„ã«è¡¨ç¤º (*:U8=0)
set -ag terminal-overrides ',*:U8=0,xterm-256color:Tc'
set -g pane-border-lines heavy

# 256è‰²ç«¯æœ«ã‚’ä½¿ã†
set -g default-terminal "screen-256color"

# prefix + Tab ã§ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’éš£ã¨å…¥ã‚Œæ›¿ãˆ
bind-key -r Tab    swap-window -t+ \; next-window
bind-key -r S-Tab  swap-window -t- \; previous-window

# prefix ãªã—ã® Ctrl-Tab ã§ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ç§»å‹•ã™ã‚‹
bind-key -rn C-Tab    next-window
bind-key -rn C-S-Tab  previous-window

# prefix ãªã—ã® Ctrl+â†’, Ctrl+â† ã§ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ç§»å‹•ã™ã‚‹
bind-key -rn C-Right  next-window
bind-key -rn C-Left   previous-window

# prefix ãªã—ã® Ctrl+â†‘, Ctri+â†“ ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã‚’ç§»å‹•ã™ã‚‹
bind-key -rn C-Up   switch-client -p
bind-key -rn C-Down switch-client -n

# prefix - Shift+C ã§æ–°è¦ã‚»ãƒƒã‚·ãƒ§ãƒ³
bind-key -r C   new-session

# prefix-x ã§ä½•ã‹ã‚’ kill
bind-key x display-menu -T 'Kill what?' \
  Process p "display-menu -T 'By which signal?' \
    '1  SIGHUP'  h 'run-shell \"kill -1  $(\"${DOTPATH}/tmux/get-current-process-pid\")\"' \
    '2  SIGINT'  i 'run-shell \"kill -2  $(\"${DOTPATH}/tmux/get-current-process-pid\")\"' \
    '3  SIGQUIT' Q 'run-shell \"kill -3  $(\"${DOTPATH}/tmux/get-current-process-pid\")\"' \
    '9  SIGKILL' k 'run-shell \"kill -9  $(\"${DOTPATH}/tmux/get-current-process-pid\")\"' \
    '15 SIGTERM' t 'run-shell \"kill -15 $(\"${DOTPATH}/tmux/get-current-process-pid\")\"' \
  " \
  Pane P kill-pane \
  Window w kill-window \
  Session s "run-shell 'tmux switch-client -n \\\; kill-session -t \"\$(tmux display-message -p \"#S\")\"'" \
  Server S kill-server

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒŠãƒ³ãƒãƒªãƒ³ã‚°ã‚’è©°ã‚ã‚‹
set-option -g renumber-windows on

# ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒŠãƒ³ãƒãƒªãƒ³ã‚°ã‚’è©°ã‚ã‚‹
set-hook -g session-created "run ~/dotfiles/tmux/reorder-sessions.sh"
set-hook -g session-closed  "run ~/dotfiles/tmux/reorder-sessions.sh"

# ãƒã‚¦ã‚¹æ“ä½œã‚’æœ‰åŠ¹ã«ã™ã‚‹
setw -g mouse on
bind-key -T copy-mode-vi WheelUpPane send-keys -X -N 1 scroll-up
bind-key -T copy-mode-vi WheelDownPane send-keys -X -N 1 scroll-down

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã®è‰²ã‚’è¨­å®šã™ã‚‹
set -g status-fg white
set -g status-bg colour29

# ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚¹ãƒˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²
setw -g window-status-style 'fg=colour36'
# ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ç›®ç«‹ãŸã›ã‚‹
setw -g window-status-current-style 'fg=black,bg=colour41'

# prefix ':' å…¥åŠ›æ™‚ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã®è‰²ã‚’è¨­å®šã™ã‚‹
# set -g message-style 'fg=white,bg=black,bright'

# ãƒšã‚¤ãƒ³ã®è¨­å®š
## ãƒšã‚¤ãƒ³ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè‰²
set -g window-style 'bg=colour235,dim'
set -g pane-border-style 'bg=colour235,fg=colour245,dim'
## ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒšã‚¤ãƒ³ã‚’ç›®ç«‹ãŸã›ã‚‹
set -g window-active-style 'bg=colour232,fg=terminal,nodim'
set -g pane-active-border-style 'bg=colour232,fg=white,nodim'
## ãƒšã‚¤ãƒ³ãƒœãƒ¼ãƒ€ãƒ¼ã«æƒ…å ±ã‚’è¡¨ç¤º
set -g pane-border-status bottom
set -g pane-border-format "#(bash ${HOME}/dotfiles/tmux/responsive-pane-status.sh '#{pane_width}' '#{pane_current_command}' '#{pane_pid}' '#{pane_current_path}')"

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã‚’è¨­å®šã™ã‚‹
## å·¦ãƒ‘ãƒãƒ«ã‚’è¨­å®šã™ã‚‹
set -g status-left-length 40
set -g status-left "#{prefix_highlight}#(bash ${HOME}/dotfiles/tmux/responsive-window-status-l.sh '#{client_width}')"
## å³ãƒ‘ãƒãƒ«ã‚’è¨­å®šã™ã‚‹
set -g status-right-length 60
set -g status-right "#(bash ${HOME}/dotfiles/tmux/responsive-window-status-r.sh '#{client_width}')"
## ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã®é–“éš”ã‚’è¨­å®šã™ã‚‹(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ 15ç§’)
# set -g status-interval 60
## ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚¹ãƒˆã®ä½ç½®ã‚’ä¸­å¿ƒå¯„ã›ã«ã™ã‚‹
set -g status-justify centre
## ãƒ´ã‚£ã‚¸ãƒ¥ã‚¢ãƒ«ãƒãƒ¼ãƒ†ã‚£ãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹
setw -g monitor-activity on
set -g visual-activity on
## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã‚’ä¸Šéƒ¨ã«è¡¨ç¤ºã™ã‚‹
set -g status-position top

# ã‚³ãƒ”ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹
## viã®ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹
setw -g mode-keys vi
## ã‚³ãƒ”ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®æ“ä½œã‚’vié¢¨ã«è¨­å®šã™ã‚‹
bind-key -T copy-mode-vi v send-keys -X begin-selection


# Tmux Plugin Manager
# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# tmux-prefix-highlight
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_prefix_prompt ' ^Q '
set -g @prefix_highlight_copy_prompt 'Copy'
set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=yellow'
set -g @prefix_highlight_empty_prompt ' TMUX '

# Install tpm if not installed
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run -b '~/.tmux/plugins/tpm/tpm'

